---
import Layout from '../../layouts/Layout.astro';
import WordCard from '../../components/WordCard.astro';
import {
  parseDate,
  getWordForDate,
  formatDisplayDate,
  getPrevDate,
  getNextDate,
  isFutureDate,
  isToday,
  getRecentWords,
} from '../../lib/words';

export function getStaticPaths() {
  return getRecentWords(Infinity).map(({ date }) => ({ params: { date } }));
}

const { date } = Astro.params;

if (!date || !parseDate(date)) {
  return Astro.redirect('/');
}

if (isFutureDate(date)) {
  return Astro.redirect('/');
}

if (isToday(date)) {
  return Astro.redirect('/');
}

const word = getWordForDate(date);

if (!word) {
  return Astro.redirect('/');
}

const displayDate = formatDisplayDate(date);
const prevDate = getPrevDate(date);
const nextDate = getNextDate(date);
const nextIsToday = nextDate !== null && isToday(nextDate);
---

<Layout title={`${word.word} â€” Woordenschat`}>
  <WordCard word={word} date={date} displayDate={displayDate} />
  <nav class="word-nav">
    {prevDate && <a href={`/archive/${prevDate}`}>&larr; Vorige</a>}
    {nextDate && (
      nextIsToday ? (
        <a href="/">Vandaag &rarr;</a>
      ) : (
        <a href={`/archive/${nextDate}`}>Volgende &rarr;</a>
      )
    )}
  </nav>
</Layout>
